<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>MasterKey Password Generater</title>
<script type="text/javascript" src="src/aes.js"></script>
<script type="text/javascript" src="src/sha512.js"></script>
<script type="text/javascript" src="src/base64.js"></script>
</head>
<body>
<script type="text/javascript">
function parseSha(sha, length) {
    length = !!length ? length : sha.length / 2;
    let bytesKey = new Array();
    for (let i = 0; i < length; i++) {
        bytesKey.push(parseInt(sha.substr(i * 2, 2), 16));
    }
    return new Uint8Array(bytesKey);
}

function parseHostName(hostname) {
    let hostNameArray = hostname.split('.');
    let hostLength = hostNameArray.length;
    let parsedHostName = hostLength > 1 ? hostNameArray[hostLength - 2] : hostname;
    if (hostLength > 2)
        if (hostNameArray[hostLength - 2].match(/com|org|net|int|edu|gov|mil/g)) parsedHostName = hostNameArray[hostLength - 3];
    return parsedHostName;
}

function makePassword(domain, masterKey, passwordLength1) {
    let domainName = parseHostName(domain);
    if (typeof masterKey == "undefined") {
        console.log("masterKey is required to make a password");
        return false;
    }
    let passwordLength = !!passwordLength1 ? passwordLength1 : 12;
    let shaKey = sha512_256(masterKey);
    let bytesKey = parseSha(shaKey);
    let textBytes = aesjs.util.convertStringToBytes(domainName);
    let aesCtr = new aesjs.ModeOfOperation.ctr(bytesKey);
    let encryptedBytes = aesCtr.encrypt(textBytes);
    let shaEncrypted = sha512(String.fromCharCode.apply(null, encryptedBytes));
    let password = shaEncrypted.substring(0, passwordLength);
    return password;
}

//makePassword2 can have both uppercase and lowercase with a shortet length compared to makePassword
function makePassword2(domain, masterKey, passwordLength1) {
    let passwordLength = !!passwordLength1 ? passwordLength1 : 12;
    let encodedPassword = Base64.encode(String.fromCharCode.apply(null, parseSha(makePassword(domain, masterKey, passwordLength1)))).replace(/[\\\/\+\=]/g, "");
    return encodedPassword.substring(0, passwordLength);
}

console.log('Password Generated for "' + parseHostName(location.hostname) + '" :\n' + makePassword2(location.hostname, "input your preferred masterKey here inside quotation marks", 16));
</script>
</body>
</html>
