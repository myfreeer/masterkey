<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>MasterKey Password Generater</title>
<script type="text/javascript" src="src/aes.js"></script>
<script type="text/javascript" src="https://rawgit.com/emn178/js-sha512/master/build/sha512.min.js"></script>
<script type="text/javascript" src="src/base64.js"></script>
</head>
<body>
<script type="text/javascript">
function matchURI(uri) {
    let domainName = uri;
    try {
        let separatedURI = uri.match(/(\w[-\w]*\w)/g);
        domainName = separatedURI.length > 1 ? separatedURI[separatedURI.length - 2] : domainName;
    } catch (e) {
        //console.log(e);
    }
    return domainName;
}

function parseSha(sha, length) {
    length = !!length ? length : sha.length / 2;
    let bytesKey = new Array();
    for (let i = 0; i < length; i++) {
        bytesKey.push(parseInt(sha.substr(i * 2, 2), 16));
    }
    return bytesKey;
}

function makePassword(domain, masterKey, passwordLength1) {
    let domainName = matchURI(domain);
    if (typeof masterKey == "undefined") {
        console.log("masterKey is required to make a password");
        return false;
    }
    let passwordLength = !!passwordLength1 ? passwordLength1 : 12;
    let shaKey = sha512_256(masterKey);
    //let bytesKey = aesjs.util.convertStringToBytes(shaKey.substring(0, 32));
    let bytesKey = parseSha(shaKey, 32);
    let textBytes = aesjs.util.convertStringToBytes(domainName);
    let aesCtr = new aesjs.ModeOfOperation.ctr(bytesKey);
    let encryptedBytes = aesCtr.encrypt(textBytes);
    let shaEncrypted = sha512(encryptedBytes)
    let password = shaEncrypted.substring(0, passwordLength);
    return password;
}

function makePassword2(domain, masterKey, passwordLength1) {
    let passwordLength = !!passwordLength1 ? passwordLength1 : 12;
    let encodedPassword = Base64.encode(String.fromCharCode.apply(null, new Uint8Array(parseSha(makePassword(domain, masterKey, passwordLength1))))).replace(/[\\\/\+\=]/g, "");
    return encodedPassword.substring(0, passwordLength);
}

console.log('Password Generated for "' + location.hostname + '" :\n' + makePassword2(location.hostname, "input your preferred masterKey here inside quotation marks", 16));
</script>
</body>
</html>
